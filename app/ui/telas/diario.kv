<DiarioScreen>:
    name: "diario"

    # (1) Layout principal corrigido
    MDFloatLayout:
        # KivyMD 2.0.0: Corrigido para rgba()
        md_bg_color: rgba(146, 199, 163, 255)

        # (2) Logo posicionado no topo
        Image:
            source: "app/assets/img.png"
            size_hint: None, None
            size: dp(70), dp(70)
            pos_hint: {"center_x": 0.5, "top": 0.95} # Posicionado
            allow_stretch: True

        # --- (3) NOVA SEÇÃO DE INPUT ---
        MDCard:
            orientation: "vertical"
            size_hint: 0.9, None
            adaptive_height: True
            pos_hint: {"center_x": 0.5, "top": 0.82} # Posição: Abaixo do logo
            md_bg_color: rgba(230, 230, 230, 255)
            padding: dp(10)
            radius: [10, 10, 10, 10]
            spacing: dp(10)

            MDLabel:
                text: "Nova Anotação do Diário:"
                font_style: "Title"
                role: "medium" 
            
            MDTextField:
                id: nova_anotacao_input # <-- ID do input
                hint_text: "Como você está se sentindo hoje?"
                mode: "filled"
                multiline: True
                height: dp(100) # Altura do campo de texto
                size_hint_y: None
                theme_bg_color: "Custom"
                md_bg_color: rgba(255, 255, 255, 255) # Fundo branco

            MDFabButton: # Botão "Salvar"
                icon: "content-save"
                pos_hint: {"center_x": 0.5}
                on_release: root.salvar_nova_anotacao() # <-- Chama o Python

        # --- (4) CARD DA TABELA (Corrigido) ---
        MDCard:
            orientation: "vertical"
            size_hint: 0.9, 0.4 # 40% da altura da tela
            md_bg_color: rgba(230, 230, 230, 255)
            padding: dp(10)
            radius: [10, 10, 10, 10]
            pos_hint: {"center_x": 0.5, "y": 0.1} # Posição: Acima da nav bar

            # Cabeçalho Fixo
            MDGridLayout:
                cols: 2
                spacing: dp(2)
                size_hint_y: None # Altura adaptativa
                height: dp(35)  # Altura fixa para o cabeçalho
                
                MDLabel:
                    text: "Dia - hora"
                    halign: "center"
                    bold: True
                    md_bg_color: rgba(217, 217, 217, 255)
                MDLabel:
                    text: "Anotações"
                    halign: "center"
                    bold: True
                    md_bg_color: rgba(217, 217, 217, 255)

            # Lista rolável para os dados
            ScrollView:
                bar_width: 0
                MDGridLayout:
                    id: tabela_container # <-- ID para o Python preencher
                    cols: 2
                    spacing: dp(5)
                    adaptive_height: True # Cresce com o conteúdo
                    padding: [0, dp(10), 0, 0] # Espaço do topo

        # (5) Barra de Navegação (Corrigida para KivyMD 2.0.0)
        MDNavigationBar:
            pos_hint: {"center_x": 0.5, "y": 0} # Fixa na base
            elevation: 2

            MDNavigationItem:
                name: "home"
                text: "Home"
                icon: "app/assets/home.png"
                on_release: root.on_nav_item_press("home")
                # (Removido MDBoxLayout interno, KivyMD 2.0.0 não precisa)

            MDNavigationItem:
                name: "conta"
                text: "Conta"
                icon: "app/assets/account.png"
                on_release: app.root.current = "home"
                # (Removido MDBoxLayout interno)