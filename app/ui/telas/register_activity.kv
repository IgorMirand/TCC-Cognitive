#:import hex kivy.utils.get_color_from_hex

# --- Cores do Tema (Baseadas no seu print) ---
#:set color_bg hex("#F5F7F6")       
#:set color_card hex("#FFFFFF")     
#:set color_primary hex("#2E7D32")  
#:set color_text hex("#1b1b1b")
#:set color_inactive hex("#BDBDBD")

# =============================================================================
# 1. COMPONENTE STEP INDICATOR
# =============================================================================
# =============================================================================
# 1. COMPONENTE STEP INDICATOR
# =============================================================================
# Note que removemos o "@MDBoxLayout", pois agora a classe existe no Python
<StepIndicator>:
    orientation: "horizontal"
    adaptive_height: True
    spacing: "4dp"
    padding: "16dp", "10dp", "16dp", "0dp"
    size_hint_y: None
    height: "60dp"
    
    # Passo 1
    MDIcon:
        # O root.current_step agora é garantido pelo Python
        icon: "numeric-1-circle" if root.current_step >= 1 else "numeric-1-circle-outline"
        theme_text_color: "Custom"
        text_color: color_primary if root.current_step >= 1 else color_inactive
        font_size: "32sp"
        pos_hint: {"center_y": .5}

    MDLinearProgressIndicator:
        value: 100 if root.current_step >= 2 else 0
        color: color_primary
        track_color: color_inactive
        size_hint_y: None
        height: "4dp"
        pos_hint: {"center_y": .5}

    # Passo 2
    MDIcon:
        icon: "numeric-2-circle" if root.current_step >= 2 else "numeric-2-circle-outline"
        theme_text_color: "Custom"
        text_color: color_primary if root.current_step >= 2 else color_inactive
        font_size: "32sp"
        pos_hint: {"center_y": .5}

    MDLinearProgressIndicator:
        value: 100 if root.current_step >= 3 else 0
        color: color_primary
        track_color: color_inactive
        size_hint_y: None
        height: "4dp"
        pos_hint: {"center_y": .5}

    # Passo 3
    MDIcon:
        icon: "numeric-3-circle" if root.current_step >= 3 else "numeric-3-circle-outline"
        theme_text_color: "Custom"
        text_color: color_primary if root.current_step >= 3 else color_inactive
        font_size: "32sp"
        pos_hint: {"center_y": .5}

# =============================================================================
# 2. TELAS (Usando BoxLayout para organizar)
# =============================================================================

# --- TELA 1: Sentimento ---
<SentimentoScreen>:
    name: 'sentimento'
    
    # O BoxLayout Vertical organiza tudo de cima para baixo automaticamente
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: color_bg
        spacing: "10dp"

        # 1. TOPO: Indicador de Passos
        StepIndicator:
            current_step: 1
            id: step_bar

        # 2. MEIO: Lista (Expansível)
        MDScrollView:
            do_scroll_x: False
            # size_hint_y: 1 faz ele ocupar todo espaço sobrando
            size_hint_y: 1 
            
            MDList:
                id: lista_sentimentos
                spacing: "2dp"
                padding: "0dp", "10dp", "0dp", "10dp"
                # A lista vai crescer aqui dentro

        # 3. RODAPÉ: Botões
        MDBoxLayout:
            orientation: "horizontal"
            adaptive_height: True
            spacing: "20dp"
            padding: "20dp"
            md_bg_color: color_bg # Garante fundo sólido atrás dos botões
            
            MDButton:
                style: "text"
                on_release: app.root.current = "home"
                size_hint_x: .4
                height: "48dp"
                MDButtonText:
                    text: "Cancelar"
                    theme_text_color: "Custom"
                    text_color: color_text
            
            Widget: # Espaço vazio no meio

            MDButton:
                style: "filled"
                theme_bg_color: "Custom"
                md_bg_color: color_primary
                on_release: root.ir_para_atividades()
                size_hint_x: .4
                height: "48dp"
                MDButtonText:
                    text: "Próximo"
                    text_color: 1, 1, 1, 1

# --- TELA 2: Atividades ---
<RegisterActivityScreen>:
    name: "register_activity"

    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: color_bg
        spacing: "10dp"

        # 1. TOPO
        StepIndicator:
            current_step: 2

        # Título centralizado
        MDLabel:
            text: "O que você fez hoje?"
            halign: "center"
            font_style: "Headline"
            role: "small"
            adaptive_height: True
            padding: "0dp", "10dp", "0dp", "10dp"
            theme_text_color: "Custom"
            text_color: color_text

        # 2. MEIO: Lista
        MDScrollView:
            do_scroll_x: False
            size_hint_y: 1
            
            MDList:
                id: lista_selecao_atividades
                padding: "0dp"
                spacing: "2dp"

        # 3. RODAPÉ
        MDBoxLayout:
            orientation: "horizontal"
            adaptive_height: True
            spacing: "20dp"
            padding: "20dp"
            
            MDButton:
                style: "text"
                size_hint_x: .4
                height: "48dp"
                on_release: app.root.current = "sentimento"
                MDButtonText:
                    text: "Voltar"
                    theme_text_color: "Custom"
                    text_color: color_text

            Widget:

            MDButton:
                style: "filled"
                theme_bg_color: "Custom"
                md_bg_color: color_primary
                size_hint_x: .4
                height: "48dp"
                on_release: root.do_register_activities()
                MDButtonText:
                    text: "Próximo"
                    text_color: 1, 1, 1, 1

# --- TELA 3: Reflexão (Mantém estrutura similar) ---
<AnotacaoDiaScreen>:
    name: "anotacao_dia"
    
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: color_bg

        StepIndicator:
            current_step: 3

        MDScrollView:
            do_scroll_x: False
            size_hint_y: 1
            
            MDBoxLayout:
                orientation: "vertical"
                padding: "20dp"
                spacing: "20dp"
                adaptive_height: True

                MDLabel:
                    text: "Reflexão Rápida"
                    font_style: "Headline"
                    role: "small"
                    halign: "center"
                    adaptive_height: True
                    theme_text_color: "Custom"
                    text_color: color_text

                MDTextField:
                    id: input_humor
                    mode: "outlined"
                    multiline: True
                    MDTextFieldHintText:
                        text: "O que influenciou seu humor?"

                MDTextField:
                    id: input_desconforto
                    mode: "outlined"
                    multiline: True
                    MDTextFieldHintText:
                        text: "Houve algum desconforto?"

                MDLabel:
                    text: "Nota do dia (Bem-estar)"
                    role: "medium"
                    theme_text_color: "Secondary"
                
                MDSlider:
                    id: slider_bem_estar
                    min: 0
                    max: 10
                    value: 5
                    step: 1
                    MDSliderHandle:
                    MDSliderValueLabel:

                MDTextField:
                    id: input_desafio
                    mode: "outlined"
                    multiline: True
                    MDTextFieldHintText:
                        text: "Qual foi o maior desafio?"
                
                MDTextField:
                    id: input_medo
                    mode: "outlined"
                    multiline: True
                    MDTextFieldHintText:
                        text: "Evitou algo por medo?"

                MDTextField:
                    id: input_vitoria
                    mode: "outlined"
                    multiline: True
                    MDTextFieldHintText:
                        text: "Uma pequena vitória de hoje"
                
                MDLabel:
                    text: "Autocuidado Hoje:"
                    role: "medium"
                
                MDBoxLayout:
                    adaptive_height: True
                    spacing: "20dp"
                    
                    MDBoxLayout:
                        adaptive_size: True
                        MDCheckbox:
                            id: check_sono
                        MDLabel:
                            text: "Sono"
                            adaptive_size: True
                            pos_hint: {"center_y": .5}

                    MDBoxLayout:
                        adaptive_size: True
                        MDCheckbox:
                            id: check_alimentacao
                        MDLabel:
                            text: "Dieta"
                            adaptive_size: True
                            pos_hint: {"center_y": .5}

                    MDBoxLayout:
                        adaptive_size: True
                        MDCheckbox:
                            id: check_movimento
                        MDLabel:
                            text: "Treino"
                            adaptive_size: True
                            pos_hint: {"center_y": .5}
        
        # Botão final fixo no rodapé da tela 3
        MDBoxLayout:
            padding: "20dp"
            adaptive_height: True
            
            MDButton:
                style: "filled"
                theme_bg_color: "Custom"
                md_bg_color: color_primary
                size_hint_x: 1
                height: "56dp"
                on_release: root.salvar_nova_anotacao()
                
                MDButtonText:
                    text: "Salvar Diário"
                    text_color: 1, 1, 1, 1